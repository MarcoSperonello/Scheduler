<html>
<body>

This is a brief tutorial on how to submit jobs, wait for their completion and get the results back. The following is everything you need to use in order to have access to all the important information (as specified in [jobStatusInformation]{@link scheduler/monitors~jobStatusInformation}) of a job whose execution has ended.<br>
A complete example is featured at the end of this tutorial.

<p>
<h3>Submitting a job</h3>
 
An instance of the [SchedulerManager]{@link scheduler/SchedulerManager} class is created and exported, under the name of Sec, when the server is launched.<br>
To submit a job, [handleRequest]{@link scheduler/SchedulerManager#handleRequest} must be called. This method requires a {@link requestData} object, which specifies who issued the request, at what time, and the details of the job to submit in the form of a {@link JobTemplate} object.<br>

An example of {@link requestData} would be:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre></td><td><pre style="margin: 0; line-height: 125%">	<span style="color: #008800; font-weight: bold">let</span> requestData <span style="color: #333333">=</span> {
		ip<span style="color: #333333">:</span> requestIp,
		time<span style="color: #333333">:</span> req.time(),
		jobData <span style="color: #333333">=</span> {
			remoteCommand<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;\&quot;/path/of/your/job/file.sh\&quot;&quot;</span>,
			workingDirectory<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;/your/working/directory&quot;</span>,
			jobName<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;name of your job&#39;</span>,
		}
	};
</pre></td></tr></table></div>




<br><br>
For all possible ways to specify the properties of the jobData object, refer to the {@link JobTemplate} documentation.<br><br>

It is now possible to call the [handleRequest]{@link scheduler/SchedulerManager#handleRequest} method, which returns a promise. For example:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">let</span> handleRequestPromise <span style="color: #333333">=</span> Sec.handleRequest(requestData);
</pre></div>
<br><br>
As explained in the [handleRequest]{@link scheduler/SchedulerManager#handleRequest} documentation, the promise resolves only if a job is succesfully submitted to the SGE; the promise is otherwise rejected. To check if the submission was successful, one can do the following:
<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%">	handleRequestPromise.then( (status) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// Success - job submitted.</span>
		<span style="color: #888888">// Do something else here (see next paragraph).</span>
	}, (error) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// Failure - job not submitted. Print the error to see what went wrong.</span>
		Logger.info(error);
	});
</pre></td></tr></table></div>


<br><br>
In the previous example, the status object which the promise resolves into in case of success is a {@link RequestOutcome} object holding several useful information, the most important of which is the job ID (stored in the jobId field) assigned by the SGE to the job that has just been submitted.

</p>
<p>
<h3> Examining the status and other relevant information of a completed job </h3>

To monitor a submitted job, it is sufficient to call the [getJobResult]{@link scheduler/SchedulerManager#getJobResult} method, which requires the id of the job to monitor and returns a promise. As explained in the documentation, said promise resolves when the job that is being monitored enters the COMPLETED or ERROR state, while it is rejected when an error occurs.<br>
In case of success, the promise resolves into a [jobStatusInformation]{@link module:scheduler/monitors~jobStatusInformation} object, containing several information about the now finished job.<br>
For example, to monitor the status of a job whose id is stored in a jobId variable, one would do:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%">	Sec.getJobResult(jobId).then( (status) <span style="color: #333333">=&gt;</span> {
		Logger.info(<span style="background-color: #fff0f0">&#39;Job &#39;</span> <span style="color: #333333">+</span> status.jobName <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; status: &#39;</span> <span style="color: #333333">+</span> status.mainStatus <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39;, description: &#39;</span> <span style="color: #333333">+</span> status.description);
	}, (error) <span style="color: #333333">=&gt;</span> {
		Logger.info(error.description);
	}
</pre></td></tr></table></div>

<br><br>
Where the status object is of the aforementioned [jobStatusInformation]{@link module:scheduler/monitors~jobStatusInformation} kind, while the error object consists of two fields: the error field, describing the error as returned by the SGE, and the description field, which explains that the status of the job could not be read.

</p>

<p>
<h3> Complete example </h3>

A fully functional example of how to submit a job and get its result once its execution has ended is obtained by simply combining the previous snippets of code:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td><pre style="margin: 0; line-height: 125%">	<span style="color: #008800; font-weight: bold">let</span> requestData <span style="color: #333333">=</span> {
	  ip<span style="color: #333333">:</span> requestIp,
	  time<span style="color: #333333">:</span> req.time(),
	  jobData <span style="color: #333333">=</span> {
	   remoteCommand<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;\&quot;/path/of/your/job/file.sh\&quot;&quot;</span>,
	 	 workingDirectory<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;/your/working/directory&quot;</span>,
		 jobName<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;name of your job&#39;</span>,
		}
	};

	<span style="color: #008800; font-weight: bold">let</span> handleRequestPromise <span style="color: #333333">=</span> Sec.handleRequest(requestData);

	handleRequestPromise.then( (status) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// NOTE: the jobId is stored in the status object returned by handleRequestPromise.</span>
		Sec.getJobResult(status.jobId).then( (status) <span style="color: #333333">=&gt;</span> {
			Logger.info(<span style="background-color: #fff0f0">&#39;Job &#39;</span> <span style="color: #333333">+</span> status.jobName <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; status: &#39;</span> <span style="color: #333333">+</span> status.mainStatus <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39;, description: &#39;</span> <span style="color: #333333">+</span> status.description);
		}, (error) <span style="color: #333333">=&gt;</span> {
			Logger.info(error.description);
		}
	}, (error) <span style="color: #333333">=&gt;</span> {
		Logger.info(error);
	});
</pre></td></tr></table></div>

</p>
</body>
</html>