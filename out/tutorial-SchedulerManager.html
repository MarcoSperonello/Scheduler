<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: SchedulerManager</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: SchedulerManager</h1>

    <section>

<header>
    

    <h2>SchedulerManager</h2>
</header>

<article>
    <html>
<body>

This is a brief tutorial on how to configure the <a href="scheduler_SchedulerManager.html">SchedulerManager</a> class and use it submit jobs, wait for their completion and get the results back. The following is everything you need to use in order to have access to all the important information (as specified in <a href="module-scheduler_monitors.html#~jobStatusInformation">jobStatusInformation</a>) of a job whose execution has ended.<br>
A complete example is featured at the end of this tutorial.


<p>
<h3>Configuring SchedulerManager</h3>

Configuration is done via a JSON file, ./input_files/input.json by default. The parameters that can be specified are the following:<br><br>

 <ul>
  	<li>
      <b><a href="scheduler_SchedulerManager.html#maxRequestsPerSecUser_">maxRequestsPerSecUser</a></b>: maximum number of requests a user can issue in a single time unit (<a href="scheduler_SchedulerManager.html#requestLifespan_">requestLifespan</a>). Requests received by a user who has issued the maximum number of requests will not be forwarded to the SGE (unless the user submitting the request is whitelisted).
    </li>
    <li>
      <b><a href="scheduler_SchedulerManager.html#maxRequestsPerSecGlobal_">maxRequestsPerSecGlobal</a></b>: maximum number of requests that can be issued by all users collectively in a single time unit (<a href="scheduler_SchedulerManager.html#requestLifespan_">requestLifespan</a>). This is a stronger constraint than <a href="scheduler_SchedulerManager.html#maxRequestsPerSecUser_">maxRequestsPerSecUser</a>. For example, if three users issued one request each in a given time unit, and <a href="scheduler_SchedulerManager.html#maxRequestsPerSecGlobal_">maxRequestsPerSecGlobal</a> was set to 3, another request by any user would be rejected (unless the user submitting the request is whitelisted).
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#userLifespan_">userLifespan</a></b>: time (in seconds) that must pass without any requests being issued by a given user, after which said user will be removed from the user history. The next time the user will submit a request, it will be as if it was the first time the user ever tried to issue one.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#requestLifespan_">requestLifespan</a></b>: time (in seconds) that a request issued by a user spends in the user's request history, after which it is deleted. This parameter represents the "time unit" mentioned in <a href="scheduler_SchedulerManager.html#maxRequestsPerSecUser_">maxRequestsPerSecUser</a> and <a href="scheduler_SchedulerManager.html#maxRequestsPerSecGlobal_">maxRequestsPerSecGlobal</a>.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#maxConcurrentJobs_">maxConcurrentJobs</a></b>: maximum number of jobs that can be handled by the SGE at the same time. Requests received by a user when the maximum number of concurrent jobs has already been reached will not be forwarded to the SGE (unless the user submitting the request is whitelisted).
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#maxJobRunningTime_">maxJobRunningTime</a></b>: maximum time (in seconds) a <a href="global.html#JOBTYPE">SINGLE</a> job submitted to the SGE can spend in the RUNNING state, after which it is terminated and removed from the job history.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#maxJobQueuedTime_">maxJobQueuedTime</a></b>: maximum time (in seconds) a <a href="global.html#JOBTYPE">SINGLE</a> job submitted to the SGE can spend in the ON_HOLD/QUEUED state (without ever switching to RUNNING), after which it is terminated and removed from the job history.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#maxArrayJobRunningTime_">maxArrayRunningJobTime</a></b>: maximum time (in seconds) an <a href="global.html#JOBTYPE">ARRAY</a> job submitted to the SGE can spend in the RUNNING state, after which it is terminated and removed from the job history. Note that an <a href="global.html#JOBTYPE">ARRAY</a> job is considered to be RUNNING once the first task starts running.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#maxArrayJobQueuedTime_">maxJobQueuedTime</a></b>: maximum time (in seconds) an <a href="global.html#JOBTYPE">ARRAY</a> job submitted to the SGE can spend in the ON_HOLD/QUEUED state (without ever switching to RUNNING), after which it is terminated and removed from the job history. Note that an <a href="global.html#JOBTYPE">ARRAY</a> job is considered to be ON_HOLD/QUEUED as long as its first task is ON_HOLD/QUEUED itself.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#localListPath_">localListPath</a></b>: path to the JSON file listing the blacklisted and whitelisted users for the service this specific instance of <a href="scheduler_SchedulerManager.html">SchedulerManager</a> module is being used for. The blacklist and whitelist fields are arrays of strings. Regular expressions are supported. See ./input_files/local-lists.json for an example.
    </li>
    <li>
			<b><a href="scheduler_SchedulerManager.html#globalListPath_">globalListPath</a></b>: path to the JSON file listing the blacklisted and whitelisted users for all services. Regular expressions are supported. See ./input_files/global-lists.json for an example.<br> If a user is present in the blacklist or whitelist defined in this file, then the user is blacklisted or whitelisted from any and all services, regardless of their presence in the lists specific to any given service.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#minimumInputUpdateInterval_">minimumInputUpdateInterval</a></b>: minimum time interval (in seconds) between two consecutive reads of the input file. The input file is read whenever a user submits a request, provided the previous read happened at least minimumInputUpdateInterval seconds ago.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#jobPollingInterval_">jobPollingInterval</a></b>: time (in seconds) dictating how often the status and several other information of a job submitted to the SGE must be checked.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#userPollingInterval_">userPollingInterval</a></b>: time (in seconds) dictating how often the user history must be checked, in order to detect and purge requests which have exceeded their requestLifespan or users whose userLifespan has expired.
    </li>
    <li>
    	<b><a href="scheduler_SchedulerManager.html#listPollingInterval_">listPollingInterval</a></b>: time (in seconds) dictating how often to read the blacklist and whitelist files specified by <a href="scheduler_SchedulerManager.html#localListPath_">localListPath</a> and <a href="scheduler_SchedulerManager.html#globalListPath_">globalListPath</a>, in order to update the blacklist and whitelist.
    </li>
 </ul>
 <br>
NOTE: a whitelisted user's requests will ALWAYS be forwarded to the SGE. Likewise, a blacklisted user's requests will ALWAYS be discarded.

<p>
<h3>Submitting a job</h3>
 
An instance of the <a href="scheduler_SchedulerManager.html">SchedulerManager</a> class is created and exported, under the name of Sec, when the server is launched.<br>
To submit a job, <a href="scheduler_SchedulerManager.html#handleRequest">handleRequest</a> must be called. This method requires a <a href="global.html#requestData">requestData</a> object, which specifies who issued the request, at what time, and the details of the job to submit in the form of a <a href="JobTemplate.html">JobTemplate</a> object.<br>

An example of <a href="global.html#requestData">requestData</a> would be:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre></td><td><pre style="margin: 0; line-height: 125%">	<span style="color: #008800; font-weight: bold">let</span> requestData <span style="color: #333333">=</span> {
		ip<span style="color: #333333">:</span> requestIp,
		time<span style="color: #333333">:</span> req.time(),
		jobData <span style="color: #333333">=</span> {
			remoteCommand<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;\&quot;/path/of/your/job/file.sh\&quot;&quot;</span>,
			workingDirectory<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;/your/working/directory&quot;</span>,
			jobName<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;name of your job&#39;</span>,
		}
	};
</pre></td></tr></table></div>




<br><br>
For all possible ways to specify the properties of the jobData object, refer to the <a href="JobTemplate.html">JobTemplate</a> documentation.<br><br>

It is now possible to call the <a href="scheduler_SchedulerManager.html#handleRequest">handleRequest</a> method, which returns a promise. For example:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">let</span> handleRequestPromise <span style="color: #333333">=</span> Sec.handleRequest(requestData);
</pre></div>
<br><br>
As explained in the <a href="scheduler_SchedulerManager.html#handleRequest">handleRequest</a> documentation, the promise resolves only if a job is succesfully submitted to the SGE; the promise is otherwise rejected. To check if the submission was successful, one can do the following:
<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%">	handleRequestPromise.then( (status) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// Success - job submitted.</span>
		<span style="color: #888888">// Do something else here (see next paragraph).</span>
	}, (error) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// Failure - job not submitted. Print the error to see what went wrong.</span>
		Logger.info(error);
	});
</pre></td></tr></table></div>


<br><br>
In the previous example, the status object which the promise resolves into in case of success is a <a href="global.html#requestOutcome">requestOutcome</a> object holding several useful information, the most important of which is the job ID (stored in the jobId field) assigned by the SGE to the job that has just been submitted.

</p>
<p>
<h3> Examining the status and other relevant information of a completed job </h3>

To monitor a submitted job, it is sufficient to call the <a href="scheduler_SchedulerManager.html#getJobResult">getJobResult</a> method, which requires the id of the job to monitor and returns a promise. As explained in the documentation, said promise resolves when the job that is being monitored enters the COMPLETED or ERROR state, while it is rejected when an error occurs.<br>
In case of success, the promise resolves into a <a href="module-scheduler_monitors.html#~jobStatusInformation">jobStatusInformation</a> object, containing several information about the now finished job.<br>
For example, to monitor the status of a job whose id is stored in a jobId variable, one would do:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%">	Sec.getJobResult(jobId).then( (status) <span style="color: #333333">=&gt;</span> {
		Logger.info(<span style="background-color: #fff0f0">&#39;Job &#39;</span> <span style="color: #333333">+</span> status.jobName <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; status: &#39;</span> <span style="color: #333333">+</span> status.mainStatus <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39;, description: &#39;</span> <span style="color: #333333">+</span> status.description);
	}, (error) <span style="color: #333333">=&gt;</span> {
		Logger.info(error.description);
	}
</pre></td></tr></table></div>

<br><br>
Where the status object is of the aforementioned <a href="module-scheduler_monitors.html#~jobStatusInformation">jobStatusInformation</a> kind, while the error object consists of two fields: the error field, describing the error as returned by the SGE, and the description field, which explains that the status of the job could not be read.

</p>

<p>
<h3> Complete example </h3>

A fully functional example of how to submit a job and get its result once its execution has ended is obtained by simply combining the previous snippets of code:<br><br>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td><pre style="margin: 0; line-height: 125%">	<span style="color: #008800; font-weight: bold">let</span> requestData <span style="color: #333333">=</span> {
	  ip<span style="color: #333333">:</span> requestIp,
	  time<span style="color: #333333">:</span> req.time(),
	  jobData <span style="color: #333333">=</span> {
	   remoteCommand<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;\&quot;/path/of/your/job/file.sh\&quot;&quot;</span>,
	 	 workingDirectory<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;/your/working/directory&quot;</span>,
		 jobName<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;name of your job&#39;</span>,
		}
	};

	<span style="color: #008800; font-weight: bold">let</span> handleRequestPromise <span style="color: #333333">=</span> Sec.handleRequest(requestData);

	handleRequestPromise.then( (status) <span style="color: #333333">=&gt;</span> {
		<span style="color: #888888">// NOTE: the jobId is stored in the status object returned by handleRequestPromise.</span>
		Sec.getJobResult(status.jobId).then( (status) <span style="color: #333333">=&gt;</span> {
			Logger.info(<span style="background-color: #fff0f0">&#39;Job &#39;</span> <span style="color: #333333">+</span> status.jobName <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39; status: &#39;</span> <span style="color: #333333">+</span> status.mainStatus <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&#39;, description: &#39;</span> <span style="color: #333333">+</span> status.description);
		}, (error) <span style="color: #333333">=&gt;</span> {
			Logger.info(error.description);
		}
	}, (error) <span style="color: #333333">=&gt;</span> {
		Logger.info(error);
	});
</pre></td></tr></table></div>

</p>
</body>
</html>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-nDrmaaExceptions.html">nDrmaaExceptions</a></li><li><a href="module-scheduler_monitors.html">scheduler/monitors</a></li><li><a href="module-sge-cli.html">sge-cli</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li><li><a href="Job.html">Job</a></li><li><a href="JobInfo.html">JobInfo</a></li><li><a href="JobInfoImpl.html">JobInfoImpl</a></li><li><a href="JobMonitor.html">JobMonitor</a></li><li><a href="JobTemplate.html">JobTemplate</a></li><li><a href="module-nDrmaaExceptions.AlreadyActiveSessionException.html">AlreadyActiveSessionException</a></li><li><a href="module-nDrmaaExceptions.DrmsInitException.html">DrmsInitException</a></li><li><a href="module-nDrmaaExceptions.ExitTimeoutException.html">ExitTimeoutException</a></li><li><a href="module-nDrmaaExceptions.InvalidArgumentException.html">InvalidArgumentException</a></li><li><a href="module-nDrmaaExceptions.InvalidSessionException.html">InvalidSessionException</a></li><li><a href="module-nDrmaaExceptions.NoActiveSessionException.html">NoActiveSessionException</a></li><li><a href="module-nDrmaaExceptions.UnsupportedAttributeException.html">UnsupportedAttributeException</a></li><li><a href="scheduler_SchedulerManager.html">scheduler/SchedulerManager</a></li><li><a href="Session.html">Session</a></li><li><a href="SessionImpl.html">SessionImpl</a></li><li><a href="SessionManager.html">SessionManager</a></li><li><a href="SessionManagerImpl.html">SessionManagerImpl</a></li><li><a href="Version.html">Version</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:JobCompleted">JobCompleted</a></li><li><a href="global.html#event:JobError">JobError</a></li><li><a href="global.html#event:qstatError">qstatError</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-SchedulerManager.html">SchedulerManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_getArrayJobStatus">_getArrayJobStatus</a></li><li><a href="global.html#_parseJobArrayStatus">_parseJobArrayStatus</a></li><li><a href="global.html#_parseJobStatus">_parseJobStatus</a></li><li><a href="global.html#_removeListeners">_removeListeners</a></li><li><a href="global.html#generateUUIDV4">generateUUIDV4</a></li><li><a href="global.html#HOLD">HOLD</a></li><li><a href="global.html#JOB_IDS_SESSION_ALL">JOB_IDS_SESSION_ALL</a></li><li><a href="global.html#JOBTYPE">JOBTYPE</a></li><li><a href="global.html#RELEASE">RELEASE</a></li><li><a href="global.html#RESUME">RESUME</a></li><li><a href="global.html#SUSPEND">SUSPEND</a></li><li><a href="global.html#TERMINATE">TERMINATE</a></li><li><a href="global.html#TIMEOUT_WAIT_FOREVER">TIMEOUT_WAIT_FOREVER</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Oct 09 2017 14:19:28 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>